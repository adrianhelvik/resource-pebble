// Generated by CoffeeScript 1.10.0
(function() {
  var controller, provide, stripIllegal;

  stripIllegal = require('./stripIllegalFields');


  /*
   * Use res.provide if available, otherwise fall back to regular json response
   */

  provide = function(res, type, data) {
    var err, error;
    try {
      if (res.provide != null) {
        return res.provide(type, data);
      } else if (type === 'success') {
        return res.status(200).json({
          status: 200,
          success: true,
          data: data
        });
      } else if (type === 'error') {
        return res.status(500).json({
          status: 500,
          success: false,
          data: data
        });
      }
    } catch (error) {
      err = error;
      throw new Error(type + " is not a registered response, but is required for resource-pebble");
    }
  };


  /*
   * Constructor function for the default controller
   */

  controller = function(Model) {
    return {
      show: function(req, res, next) {
        return Model.findById(req.params.id, function(err, data) {
          if (err != null) {
            return provide(res, 'error', err);
          }
          return provide(res, 'success', data);
        });
      },
      all: function(req, res, next) {
        return Model.find({}, function(err, data) {
          if (err != null) {
            return provide(res, 'error', err);
          }
          return provide(res, 'success', data);
        });
      },
      create: function(req, res, next) {
        var instance;
        instance = new Model(stripIllegal(req.body));
        return instance.save(function(err) {
          if (err != null) {
            return provide(res, 'error', err);
          }
          return provide(res, 'success', instance);
        });
      },
      update: function(req, res, next) {
        return Model.findOneAndUpdate(req.params.id, stripIllegal(req.body), function(err, data) {
          if (err != null) {
            return provide(res, 'error', err);
          }
          return provide(res, 'success', data);
        });
      },
      destroy: function(req, res, next) {
        return Model.findOneAndRemove(req.params.id, function(err, data) {
          if (err != null) {
            return provide(res, 'error', err);
          }
          return provide(res, 'success', data);
        });
      }
    };
  };

  module.exports = controller;

}).call(this);
